## Non-Negotiable Rules (Shared)

### Platform constraints (docs-backed)

- Zero YAML TypeScript projects do not use `nango.yaml`. Define functions with `createAction()` or `createSync()`.
- Register every action/sync in `index.ts` via side-effect import (`import './<path>.js'`) or it will not load.
- You cannot install/import arbitrary third-party packages in Functions. Relative imports inside the Nango project are supported. Pre-included dependencies include `zod`, `crypto`/`node:crypto`, and `url`/`node:url`.
- Sync records must include a stable string `id`.
- Action outputs cannot exceed 2MB.
- `deleteRecordsFromPreviousExecutions()` is for full refresh syncs only. Call it only after you successfully fetched + saved the full dataset; do not swallow errors and still call it.
- HTTP request retries default to `0`. Set `retries` intentionally (and be careful retrying non-idempotent writes).

### Dryrun + tests (hard rules)

- Default dryruns to `-e dev --no-interactive --auto-confirm` (agents commonly run in non-interactive contexts).
- Actions: never omit `--input` in `nango dryrun` (use `--input '{}'` for empty input).
- Never hand-author, edit, rename, or move `*.test.json` (including changing any recorded `hash` fields). Treat `*.test.json` as generated, read-only artifacts.
  - `*.test.json` must be generated by `nango dryrun <script-name> <connection-id> --save` after a successful `--validate`.
  - If validation/save can't pass, stop and return early stating exactly what external state/inputs are missing (e.g., connection id, required metadata, required scopes/permissions, or a real sample response/resource id). Do not fabricate placeholder IDs or hashes (e.g., `sample_hash_for_testing`, `mock-hash`) to make tests pass.
  - If mocks are wrong/out-of-date, fix the code and re-record by re-running dryrun with `--save`.
- After `--save`, run `nango generate:tests` (required) to generate/update `<script-name>.test.ts`.

### Error-path testing (do not encode errors in mocks)

- If you need to test error handling (404/401/429/timeouts), add/extend Vitest tests to mock `nangoMock.get/post/patch/delete` with `vi.spyOn(...).mockRejectedValueOnce(...)` or `mockResolvedValueOnce(...)`.
- Do not hand-edit `*.test.json` to hard-code error payloads, HTML bodies, or modified URLs.

### Conventions (recommended)

- Prefer explicit parameter names (`user_id`, `channel_id`, `team_id`).
- Add `.describe()` examples for IDs, timestamps, enums, and URLs.
- Avoid `any`; use inline types when mapping responses.
- Prefer static Nango endpoint paths (avoid `:id` / `{id}` in the exposed endpoint); pass IDs in input/params.
- Add an API doc link comment above each provider API call.
- Standardize list actions on `cursor`/`next_cursor`.
- For optional outputs, return `null` only when the output schema models `null`.
- Use `nango.zodValidateInput()` when you need custom input validation/logging; otherwise rely on schemas + `nango dryrun --validate`.
- Zod: `z.object()` strips unknown keys by default. For provider payload pass-through use `z.object({}).passthrough()`, `z.record(z.unknown())`, or `z.unknown()` with minimal refinements.

### Parameter Naming Rules

- IDs: suffix with _id (user_id, channel_id)
- Names: suffix with _name (channel_name)
- Emails: suffix with _email (user_email)
- URLs: suffix with _url (callback_url)
- Timestamps: use *_at or *_time (created_at, scheduled_time)

Mapping example (API expects a different parameter name):

```typescript
const InputSchema = z.object({
    user_id: z.string()
});

const config: ProxyConfiguration = {
    endpoint: 'users.info',
    params: {
        user: input.user_id
    },
    retries: 3
};
```
